<div class="view receipts-view">
  <header class="view-header">
    <div>
      <h1 class="view-title">Receipts</h1>
      <p class="view-subtitle">
        Browse sales (OUT) and restock (IN) receipts, search by party, and jump into the original record.
      </p>
    </div>
    <div class="header-actions">
      <button class="btn" type="button" (click)="reload()">Reload</button>
    </div>
  </header>

  <section class="surface-card controls-card">
    <div class="controls">
      <label class="form-field flex-1">
        <span>Search</span>
        <input
          [(ngModel)]="filters.q"
          (input)="applyFilters()"
          placeholder="Search by receipt id, cashier, or party"
        />
      </label>

      <label class="form-field">
        <span>Mode</span>
        <select [(ngModel)]="filters.mode" (change)="applyFilters()">
          <option value="">All</option>
          <option value="OUT">OUT (Sale)</option>
          <option value="IN">IN (Restock)</option>
        </select>
      </label>

      <button class="btn btn-ghost" type="button" (click)="reset()">Reset</button>
    </div>
  </section>

  <div *ngIf="loading" class="state">Loadingâ€¦</div>
  <div *ngIf="!loading && error" class="state error">{{ error }}</div>

  <section class="table-card" *ngIf="!loading && !error">
    <table *ngIf="paged.length; else noData">
      <thead>
        <tr>
          <th>#</th>
          <th>Date</th>
          <th>Mode</th>
          <th>Party</th>
          <th>Cashier</th>
          <th>Type</th>
          <th style="text-align: right">Total</th>
          <th style="text-align: right">Paid</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of paged">
          <td>{{ r.id }}</td>
          <td>{{ r.date | date : 'short' }}</td>
          <td>
            <span
              class="badge"
              [ngClass]="{ 'badge--blue': r.mode === 'OUT', 'badge--green': r.mode === 'IN' }"
            >
              {{ r.mode }}
            </span>
          </td>
          <td>{{ displayParty(r) }}</td>
          <td>{{ displayUser(r) }}</td>
          <td>{{ r.type }}</td>
          <td style="text-align: right">{{ r.total | number : '1.2-2' }}</td>
          <td style="text-align: right">{{ (r.paid ?? 0) | number : '1.2-2' }}</td>
          <td>
            <span
              class="status-pill"
              [attr.data-status]="r.status === 'paid' ? 'paid' : r.status === 'partial' ? 'partial' : 'unpaid'"
            >
              {{ (r.statusCode || r.status || 'UNPAID') | uppercase }}
            </span>
          </td>
          <td class="actions">
            <button class="btn btn-ghost" type="button" (click)="view(r)">View</button>
            <button class="btn btn-outline" type="button" (click)="print(r)">Print</button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #noData>
      <p class="empty-state">No receipts found.</p>
    </ng-template>
  </section>

  <div class="pagination" *ngIf="totalPages > 1">
    <button class="btn" type="button" (click)="prevPage()" [disabled]="page === 1">
      Previous
    </button>
    <span>Page {{ page }} of {{ totalPages }}</span>
    <button class="btn" type="button" (click)="nextPage()" [disabled]="page === totalPages">
      Next
    </button>
  </div>
</div>
